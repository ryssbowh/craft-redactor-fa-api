"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var FaGraphQl=function(){function n(e,t){_classCallCheck(this,n),this.version=e,this.license=t}return _createClass(n,[{key:"search",value:function(e){var s=this;return new Promise(function(o,t){s.query('search(version:"'+s.version+'",query:"'+e+'") {membership {free, pro},id,label}').then(function(e){var t,n=[];for(t in e.data.search){var i=e.data.search[t].membership[s.license];i.length&&n.push({id:e.data.search[t].id,label:e.data.search[t].label,styles:i})}o(n)},function(e){t(e)})})}},{key:"icons",value:function(){var i=this;return this.iconList?new Promise(function(e,t){e(i.iconList)}):new Promise(function(t,n){i.release('icons(license: "'+i.license+'") {id,label,styles}').then(function(e){t(e.data.release.icons)},function(e){n(e)})})}},{key:"release",value:function(e){return this.query('release(version:"'+this.version+'"){'+e+"}")}},{key:"query",value:function(e){var i={query:"query {"+e+"}"};return new Promise(function(t,n){$.ajax({method:"post",url:"https://api.fontawesome.com",data:i,dataType:"json"}).done(function(e){if(e.errors)return n(e.errors);t(e)})})}}]),n}();!function(){var e;Redactor.add("plugin","fontawesome",{keyupTimeout:null,modal:null,form:null,translations:{en:(_defineProperty(e={title:"Font Awesome Icon",search:"Enter an icon name",cancel:"Cancel",placeholder:"Icon name or id"},"search","Search"),_defineProperty(e,"loading","Loading..."),_defineProperty(e,"apiError","Couldn't fetch icons from the api"),e)},modals:{fontawesome:'<div class="redactor-fa-modal">            <form action="">                <input name="icon-name" placeholder="## placeholder ##" autocomplete="off">            </form>            <div class="result-list-wrapper">                <div class="loading">## loading ##</div>                <div class="errors"></div>                <div class="result-list"></div>            </div>            </div>'},init:function(e){this.app=e,this.opts=e.opts,this.lang=e.lang,this.toolbar=e.toolbar,this.insertion=e.insertion,e.opts.redactorFaApi.preventReplaceI&&delete e.opts.replaceTags.i,"path"==this.opts.redactorFaApi.mode?this._initPath():this._initKit()},_initPath:function(){this.graphQl=new FaGraphQl(this.opts.redactorFaApi.version,this.opts.redactorFaApi.license)},_initKit:function(){this.graphQl=new FaGraphQl(window.FontAwesomeKitConfig.version,window.FontAwesomeKitConfig.license)},onmodal:{fontawesome:{opened:function(e,t){var n=this;this.modal=e,(this.form=t).getField("icon-name").focus(),t.getField("icon-name").on("click",function(e){e.stopPropagation()}),t.getField("icon-name").on("focus",function(e){n._showList(),n._search()}),t.getField("icon-name").on("keyup",function(e){clearTimeout(n.keyupTimeout),e.target.value?(n._showList(),n.keyupTimeout=setTimeout(function(){n._search()},300)):n._closeList()}),t.on("submit",function(e){e.preventDefault()}),document.addEventListener("click",function(){n._closeList()})}}},start:function(){var e={title:this.lang.get("title"),api:"plugin.fontawesome.open"};this.toolbar.addButton("title",e).setIcon('<i class="fa-solid fa-font-awesome"></i>')},open:function(){var e={title:this.lang.get("myplugin"),width:"600px",name:"fontawesome",handle:"fontawesome"};this.app.api("module.modal.build",e)},_search:function(){var e,t,n,i=this,o=this.form.getField("icon-name").val();o&&(e=this.modal.nodes[0].querySelector(".errors"),t=this.modal.nodes[0].querySelector(".loading"),n=this.modal.nodes[0].querySelector(".result-list"),this.graphQl.search(o).then(function(e){i._buildResults(e,n),t.style.display="none"},function(){t.style.display="none",i._showError(e)}))},_showError:function(e){e.style.display="block",e.innerHTML=this.lang.get("apiError")},_buildResults:function(e,i){var o=this;e.forEach(function(n){n.styles.forEach(function(e){var t="fa-"+e+" fa-"+n.id,e=document.createElement("div");e.classList.add("icon"),e.innerHTML='<i class="'+t+'"></i><label>'+n.label+"</label>",i.append(e),e.addEventListener("click",function(){o._insert(t)})})})},_showList:function(){this.modal.nodes[0].querySelector(".loading").style.display="block",this.modal.nodes[0].querySelector(".errors").style.display="none",this.modal.nodes[0].querySelector(".result-list").innerHTML="",this.modal.nodes[0].querySelector(".result-list-wrapper").style.display="block"},_closeList:function(){this.modal.nodes[0].querySelector(".result-list-wrapper").style.display="none"},_insert:function(e){this._closeList(),this.app.api("module.modal.close"),this.insertion.insertHtml('<span><i class="'+e+'"></i></span>')}})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZGFjdG9yLXBsdWdpbnMvZm9udGF3ZXNvbWUvZm9udGF3ZXNvbWUuanMiXSwibmFtZXMiOlsiRmFHcmFwaFFsIiwidmVyc2lvbiIsImxpY2Vuc2UiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwibmFtZSIsIl90aGlzIiwiUHJvbWlzZSIsInJlcyIsInJlaiIsInF1ZXJ5IiwidGhlbiIsImRhdGEiLCJpIiwiaWNvbnMiLCJzZWFyY2giLCJzdHlsZXMiLCJtZW1iZXJzaGlwIiwibGVuZ3RoIiwicHVzaCIsImlkIiwibGFiZWwiLCJlcnJvcnMiLCJfdGhpczIiLCJpY29uTGlzdCIsInJlbGVhc2UiLCJmaWVsZHMiLCJjb21tYW5kIiwibWV0aG9kIiwidXJsIiwiZGF0YVR5cGUiLCJkb25lIiwiX2VuIiwiUmVkYWN0b3IiLCJhZGQiLCJrZXl1cFRpbWVvdXQiLCJmb3JtIiwidHJhbnNsYXRpb25zIiwiX2RlZmluZVByb3BlcnR5IiwidGl0bGUiLCJmb250YXdlc29tZSIsImluaXQiLCJhcHAiLCJvcHRzIiwibGFuZyIsInRvb2xiYXIiLCJpbnNlcnRpb24iLCJyZWRhY3RvckZhQXBpIiwicHJldmVudFJlcGxhY2VJIiwicmVwbGFjZVRhZ3MiLCJtb2RlIiwiX2luaXRQYXRoIiwiX2luaXRLaXQiLCJncmFwaFFsIiwid2luZG93IiwiRm9udEF3ZXNvbWVLaXRDb25maWciLCJvbm1vZGFsIiwib3BlbmVkIiwiJG1vZGFsIiwiJGZvcm0iLCJfdGhpczMiLCJtb2RhbCIsImdldEZpZWxkIiwiZm9jdXMiLCJvbiIsImUiLCJfc2VhcmNoIiwiY2xlYXJUaW1lb3V0IiwidGFyZ2V0IiwidmFsdWUiLCJfc2hvd0xpc3QiLCJzZXRUaW1lb3V0IiwiX2Nsb3NlTGlzdCIsInByZXZlbnREZWZhdWx0IiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic3RvcFByb3BhZ2F0aW9uIiwiZ2V0IiwiYXBpIiwiYWRkQnV0dG9uIiwic2V0SWNvbiIsIm9wZW4iLCJvcHRpb25zIiwid2lkdGgiLCJsb2FkaW5nIiwibGlzdCIsIl90aGlzNCIsInZhbCIsIm5vZGVzIiwicXVlcnlTZWxlY3RvciIsInN0eWxlIiwiZGlzcGxheSIsIl9zaG93RXJyb3IiLCJpbm5lckhUTUwiLCJfdGhpczUiLCJmb3JFYWNoIiwiaWNvbiIsImZhQ2xhc3MiLCJlbGVtIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFwcGVuZCIsIl9pbnNlcnQiLCJpbnNlcnRIdG1sIl0sIm1hcHBpbmdzIjoiZ2xCQUFNQSxVLFdBQ0YsU0FBQUEsRUFBWUMsRUFBU0MsR0FDckJDLGdCQUFBQyxLQUFBSixHQUNJSSxLQUFLSCxRQUFVQSxFQUNmRyxLQUFLRixRQUFVQSxFLDJDQUduQixTQUFPRyxHQUNQLElBQUFDLEVBQUFGLEtBQ0ksT0FBTyxJQUFJRyxRQUFRLFNBQUNDLEVBQUtDLEdBVDNCVCxFQVVXVSxNQUFNLG1CQUFxQkosRUFBS0wsUUFBVSxZQUFjSSxFQUFPLHdDQUF3Q00sS0FBSyxTQUFDQyxHQVQxSCxJQUNBQyxFQURBQyxFQUFBLEdBQ0EsSUFBQUQsS0FBQUQsRUFBQUEsS0FBQUcsT0FBQSxDQVdnQixJQUFJQyxFQUFTSixFQUFLQSxLQUFLRyxPQUFPRixHQUFHSSxXQUFXWCxFQUFLSixTQVY5Q0QsRUFBZmlCLFFBY1lKLEVBQU1LLEtBQUssQ0FDUEMsR0FBSVIsRUFBS0EsS0FBS0csT0FBT0YsR0FBR08sR0FDeEJDLE1BQU9ULEVBQUtBLEtBQUtHLE9BQU9GLEdBQUdRLE1BWi9DTCxPQUFBQSxJQUVXUixFQUFJRCxJQUNGRyxTQUFBQSxHQUNHSSxFQUFLUSxTLG1CQUdMLFdBQ0ksSUFBQUMsRUFBQW5CLEtBQ0gsT0FBQUEsS0FBQW9CLFNBT0RWLElBQURQLFFBQUgsU0FBQUMsRUFBQUMsR0FDREQsRUFBQWUsRUFBQ0QsWUFTRyxJQUFJZixRQUFRLFNBQUNDLEVBQUtDLEdBaEJqQkssRUFBTUssUUFBSyxtQkFBQUksRUFBQXJCLFFBQUEsd0JBQUFTLEtBQUEsU0FBQUMsR0FDSEEsRUFBS0Es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QSxHQUFBQyxjQUFBLGdCQUFBSSxVQUFBLEdBQ1B6RixLQUFBeUQsTUFBQTJCLE1BQUEsR0FBQUMsY0FBQSx3QkFBQUMsTUFBQUMsUUFBQSxTQXNDUm5CLFdBekpKLFdBc0hZWSxLQUFPdkIsTUFBRzJCLE1BQUszQixHQUFNMkIsY0FBU0Msd0JBQWxDQyxNQUFBQyxRQUFBLFFBRUFXLFFBeEhSLFNBd0hhakQsR0F1Q0xqRCxLQUFLb0UsYUFyQ0RZLEtBQVFNLElBQVJaLElBQWNhLHNCQUNmdkYsS0FBQTBDLFVBQU15RCxXQUFBLG1CQUFBTixFQUFBLG9CQXZHbkIiLCJmaWxlIjoicmVkYWN0b3ItcGx1Z2lucy9mb250YXdlc29tZS9mb250YXdlc29tZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEZhR3JhcGhRbCB7XG4gICAgY29uc3RydWN0b3IodmVyc2lvbiwgbGljZW5zZSlcbiAgICB7XG4gICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgIHRoaXMubGljZW5zZSA9IGxpY2Vuc2U7XG4gICAgfVxuXG4gICAgc2VhcmNoKG5hbWUpXG4gICAge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5KCdzZWFyY2godmVyc2lvbjpcIicgKyB0aGlzLnZlcnNpb24gKyAnXCIscXVlcnk6XCInICsgbmFtZSArICdcIikge21lbWJlcnNoaXAge2ZyZWUsIHByb30saWQsbGFiZWx9JykudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBpY29ucyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgaW4gZGF0YS5kYXRhLnNlYXJjaCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3R5bGVzID0gZGF0YS5kYXRhLnNlYXJjaFtpXS5tZW1iZXJzaGlwW3RoaXMubGljZW5zZV07XG4gICAgICAgICAgICAgICAgICAgIGlmICghc3R5bGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWNvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZGF0YS5kYXRhLnNlYXJjaFtpXS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBkYXRhLmRhdGEuc2VhcmNoW2ldLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGVzOiBzdHlsZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlcyhpY29ucyk7XG4gICAgICAgICAgICB9LCAoZXJyb3JzKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVqKGVycm9ycyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWNvbnMoKVxuICAgIHtcbiAgICAgICAgaWYgKCF0aGlzLmljb25MaXN0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWxlYXNlKCdpY29ucyhsaWNlbnNlOiBcIicgKyB0aGlzLmxpY2Vuc2UgKyAnXCIpIHtpZCxsYWJlbCxzdHlsZXN9JykudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXMoZGF0YS5kYXRhLnJlbGVhc2UuaWNvbnMpO1xuICAgICAgICAgICAgICAgIH0sIChlcnJvcnMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVqKGVycm9ycyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICByZXModGhpcy5pY29uTGlzdCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlbGVhc2UoZmllbGRzKVxuICAgIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucXVlcnkoJ3JlbGVhc2UodmVyc2lvbjpcIicgKyB0aGlzLnZlcnNpb24gKyAnXCIpeycgKyBmaWVsZHMgKyAnfScpO1xuICAgIH1cblxuICAgIHF1ZXJ5KGNvbW1hbmQpXG4gICAge1xuICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgIHF1ZXJ5OiBcInF1ZXJ5IHtcIiArIGNvbW1hbmQgKyBcIn1cIlxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLmZvbnRhd2Vzb21lLmNvbScsXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgICAgICB9KS5kb25lKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuZXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWooZGF0YS5lcnJvcnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXMoZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4hKGZ1bmN0aW9uIChpKSB7XG4gICAgaS5hZGQoXCJwbHVnaW5cIiwgXCJmb250YXdlc29tZVwiLCB7XG4gICAgICAgIGtleXVwVGltZW91dDogbnVsbCxcbiAgICAgICAgbW9kYWw6IG51bGwsXG4gICAgICAgIGZvcm06IG51bGwsXG4gICAgICAgIHRyYW5zbGF0aW9uczoge2VuOiBcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJGb250IEF3ZXNvbWUgSWNvblwiLFxuICAgICAgICAgICAgICAgIHNlYXJjaDogXCJFbnRlciBhbiBpY29uIG5hbWVcIixcbiAgICAgICAgICAgICAgICBjYW5jZWw6IFwiQ2FuY2VsXCIsXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiSWNvbiBuYW1lIG9yIGlkXCIsXG4gICAgICAgICAgICAgICAgc2VhcmNoOiBcIlNlYXJjaFwiLFxuICAgICAgICAgICAgICAgIGxvYWRpbmc6IFwiTG9hZGluZy4uLlwiLFxuICAgICAgICAgICAgICAgIGFwaUVycm9yOiBcIkNvdWxkbid0IGZldGNoIGljb25zIGZyb20gdGhlIGFwaVwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG1vZGFsczoge1xuICAgICAgICAgICAgZm9udGF3ZXNvbWU6ICc8ZGl2IGNsYXNzPVwicmVkYWN0b3ItZmEtbW9kYWxcIj5cXFxuICAgICAgICAgICAgPGZvcm0gYWN0aW9uPVwiXCI+XFxcbiAgICAgICAgICAgICAgICA8aW5wdXQgbmFtZT1cImljb24tbmFtZVwiIHBsYWNlaG9sZGVyPVwiIyMgcGxhY2Vob2xkZXIgIyNcIiBhdXRvY29tcGxldGU9XCJvZmZcIj5cXFxuICAgICAgICAgICAgPC9mb3JtPlxcXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmVzdWx0LWxpc3Qtd3JhcHBlclwiPlxcXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImxvYWRpbmdcIj4jIyBsb2FkaW5nICMjPC9kaXY+XFxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZXJyb3JzXCI+PC9kaXY+XFxcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwicmVzdWx0LWxpc3RcIj48L2Rpdj5cXFxuICAgICAgICAgICAgPC9kaXY+XFxcbiAgICAgICAgICAgIDwvZGl2PidcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGkpIHtcbiAgICAgICAgICAgICh0aGlzLmFwcCA9IGkpLCAodGhpcy5vcHRzID0gaS5vcHRzKSwgKHRoaXMubGFuZyA9IGkubGFuZyksICh0aGlzLnRvb2xiYXIgPSBpLnRvb2xiYXIpLCAodGhpcy5pbnNlcnRpb24gPSBpLmluc2VydGlvbik7XG4gICAgICAgICAgICBpZiAoaS5vcHRzLnJlZGFjdG9yRmFBcGkucHJldmVudFJlcGxhY2VJKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGkub3B0cy5yZXBsYWNlVGFncy5pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMub3B0cy5yZWRhY3RvckZhQXBpLm1vZGUgPT0gJ3BhdGgnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdFBhdGgoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdEtpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBfaW5pdFBhdGgoKSB7XG4gICAgICAgICAgICB0aGlzLmdyYXBoUWwgPSBuZXcgRmFHcmFwaFFsKHRoaXMub3B0cy5yZWRhY3RvckZhQXBpLnZlcnNpb24sIHRoaXMub3B0cy5yZWRhY3RvckZhQXBpLmxpY2Vuc2UpO1xuICAgICAgICB9LFxuICAgICAgICBfaW5pdEtpdCgpIHtcbiAgICAgICAgICAgIHRoaXMuZ3JhcGhRbCA9IG5ldyBGYUdyYXBoUWwod2luZG93LkZvbnRBd2Vzb21lS2l0Q29uZmlnLnZlcnNpb24sIHdpbmRvdy5Gb250QXdlc29tZUtpdENvbmZpZy5saWNlbnNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25tb2RhbDoge1xuICAgICAgICAgICAgZm9udGF3ZXNvbWU6IHtcbiAgICAgICAgICAgICAgICBvcGVuZWQ6IGZ1bmN0aW9uKCRtb2RhbCwgJGZvcm0pXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsID0gJG1vZGFsO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmZvcm0gPSAkZm9ybTtcbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZ2V0RmllbGQoJ2ljb24tbmFtZScpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmdldEZpZWxkKCdpY29uLW5hbWUnKS5vbignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmdldEZpZWxkKCdpY29uLW5hbWUnKS5vbignZm9jdXMnLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd0xpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlYXJjaCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZ2V0RmllbGQoJ2ljb24tbmFtZScpLm9uKCdrZXl1cCcsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5rZXl1cFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2hvd0xpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmtleXVwVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZWFyY2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jbG9zZUxpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgJGZvcm0ub24oJ3N1Ym1pdCcsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2Nsb3NlTGlzdCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGFydDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGkgPSB7IHRpdGxlOiB0aGlzLmxhbmcuZ2V0KFwidGl0bGVcIiksIGFwaTogXCJwbHVnaW4uZm9udGF3ZXNvbWUub3BlblwiIH07XG4gICAgICAgICAgICB0aGlzLnRvb2xiYXIuYWRkQnV0dG9uKFwidGl0bGVcIiwgaSkuc2V0SWNvbignPGkgY2xhc3M9XCJmYS1zb2xpZCBmYS1mb250LWF3ZXNvbWVcIj48L2k+Jyk7XG4gICAgICAgIH0sXG4gICAgICAgIG9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLmxhbmcuZ2V0KCdteXBsdWdpbicpLFxuICAgICAgICAgICAgICAgIHdpZHRoOiAnNjAwcHgnLFxuICAgICAgICAgICAgICAgIG5hbWU6ICdmb250YXdlc29tZScsXG4gICAgICAgICAgICAgICAgaGFuZGxlOiAnZm9udGF3ZXNvbWUnXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5hcHAuYXBpKCdtb2R1bGUubW9kYWwuYnVpbGQnLCBvcHRpb25zKTtcbiAgICAgICAgfSxcbiAgICAgICAgX3NlYXJjaDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbGV0IG5hbWUgPSB0aGlzLmZvcm0uZ2V0RmllbGQoJ2ljb24tbmFtZScpLnZhbCgpO1xuICAgICAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGVycm9ycyA9IHRoaXMubW9kYWwubm9kZXNbMF0ucXVlcnlTZWxlY3RvcignLmVycm9ycycpO1xuICAgICAgICAgICAgbGV0IGxvYWRpbmcgPSB0aGlzLm1vZGFsLm5vZGVzWzBdLnF1ZXJ5U2VsZWN0b3IoJy5sb2FkaW5nJyk7XG4gICAgICAgICAgICBsZXQgbGlzdCA9IHRoaXMubW9kYWwubm9kZXNbMF0ucXVlcnlTZWxlY3RvcignLnJlc3VsdC1saXN0Jyk7XG4gICAgICAgICAgICB0aGlzLmdyYXBoUWwuc2VhcmNoKG5hbWUpLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWlsZFJlc3VsdHMoZGF0YSwgbGlzdCk7XG4gICAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICB0aGlzLl9zaG93RXJyb3IoZXJyb3JzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBfc2hvd0Vycm9yKGVycm9ycykge1xuICAgICAgICAgICAgZXJyb3JzLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAgICAgZXJyb3JzLmlubmVySFRNTCA9IHRoaXMubGFuZy5nZXQoJ2FwaUVycm9yJyk7XG4gICAgICAgIH0sXG4gICAgICAgIF9idWlsZFJlc3VsdHM6IGZ1bmN0aW9uIChpY29ucywgbGlzdCkge1xuICAgICAgICAgICAgaWNvbnMuZm9yRWFjaCgoaWNvbikgPT4ge1xuICAgICAgICAgICAgICAgIGljb24uc3R5bGVzLmZvckVhY2goKHN0eWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBmYUNsYXNzID0gJ2ZhLScgKyBzdHlsZSArICcgZmEtJyArIGljb24uaWQ7XG4gICAgICAgICAgICAgICAgICAgIGxldCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnaWNvbicpO1xuICAgICAgICAgICAgICAgICAgICBlbGVtLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cIicgKyBmYUNsYXNzICsgJ1wiPjwvaT48bGFiZWw+JyArIGljb24ubGFiZWwgKyAnPC9sYWJlbD4nO1xuICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZChlbGVtKTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2luc2VydChmYUNsYXNzKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBfc2hvd0xpc3QoKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLm1vZGFsLm5vZGVzWzBdLnF1ZXJ5U2VsZWN0b3IoJy5sb2FkaW5nJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgICB0aGlzLm1vZGFsLm5vZGVzWzBdLnF1ZXJ5U2VsZWN0b3IoJy5lcnJvcnMnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgICAgdGhpcy5tb2RhbC5ub2Rlc1swXS5xdWVyeVNlbGVjdG9yKCcucmVzdWx0LWxpc3QnKS5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAgIHRoaXMubW9kYWwubm9kZXNbMF0ucXVlcnlTZWxlY3RvcignLnJlc3VsdC1saXN0LXdyYXBwZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgfSxcbiAgICAgICAgX2Nsb3NlTGlzdCgpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMubW9kYWwubm9kZXNbMF0ucXVlcnlTZWxlY3RvcignLnJlc3VsdC1saXN0LXdyYXBwZXInKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9LFxuICAgICAgICBfaW5zZXJ0KGZhQ2xhc3MpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRoaXMuX2Nsb3NlTGlzdCgpO1xuICAgICAgICAgICAgdGhpcy5hcHAuYXBpKCdtb2R1bGUubW9kYWwuY2xvc2UnKTtcbiAgICAgICAgICAgIHRoaXMuaW5zZXJ0aW9uLmluc2VydEh0bWwoJzxzcGFuPjxpIGNsYXNzPVwiJyArIGZhQ2xhc3MgKyAnXCI+PC9pPjwvc3Bhbj4nKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoUmVkYWN0b3IpOyJdfQ==
